"use strict";
/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.isAttributeValue = exports.isAttributeKey = exports.sanitizeAttributes = void 0;
const api_1 = require("@opentelemetry/api");
function sanitizeAttributes(attributes) {
    const out = {};
    if (typeof attributes !== 'object' || attributes == null) {
        return out;
    }
<<<<<<< HEAD
    for (const [key, val] of Object.entries(attributes)) {
=======
    for (const key in attributes) {
        if (!Object.prototype.hasOwnProperty.call(attributes, key)) {
            continue;
        }
>>>>>>> 5e3222a0 (Initial commit for Agriconnect Kenya project)
        if (!isAttributeKey(key)) {
            api_1.diag.warn(`Invalid attribute key: ${key}`);
            continue;
        }
<<<<<<< HEAD
=======
        const val = attributes[key];
>>>>>>> 5e3222a0 (Initial commit for Agriconnect Kenya project)
        if (!isAttributeValue(val)) {
            api_1.diag.warn(`Invalid attribute value set for key: ${key}`);
            continue;
        }
        if (Array.isArray(val)) {
            out[key] = val.slice();
        }
        else {
            out[key] = val;
        }
    }
    return out;
}
exports.sanitizeAttributes = sanitizeAttributes;
function isAttributeKey(key) {
<<<<<<< HEAD
    return typeof key === 'string' && key.length > 0;
=======
    return typeof key === 'string' && key !== '';
>>>>>>> 5e3222a0 (Initial commit for Agriconnect Kenya project)
}
exports.isAttributeKey = isAttributeKey;
function isAttributeValue(val) {
    if (val == null) {
        return true;
    }
    if (Array.isArray(val)) {
        return isHomogeneousAttributeValueArray(val);
    }
<<<<<<< HEAD
    return isValidPrimitiveAttributeValue(val);
=======
    return isValidPrimitiveAttributeValueType(typeof val);
>>>>>>> 5e3222a0 (Initial commit for Agriconnect Kenya project)
}
exports.isAttributeValue = isAttributeValue;
function isHomogeneousAttributeValueArray(arr) {
    let type;
    for (const element of arr) {
        // null/undefined elements are allowed
        if (element == null)
            continue;
<<<<<<< HEAD
        if (!type) {
            if (isValidPrimitiveAttributeValue(element)) {
                type = typeof element;
=======
        const elementType = typeof element;
        if (elementType === type) {
            continue;
        }
        if (!type) {
            if (isValidPrimitiveAttributeValueType(elementType)) {
                type = elementType;
>>>>>>> 5e3222a0 (Initial commit for Agriconnect Kenya project)
                continue;
            }
            // encountered an invalid primitive
            return false;
        }
<<<<<<< HEAD
        if (typeof element === type) {
            continue;
        }
=======
>>>>>>> 5e3222a0 (Initial commit for Agriconnect Kenya project)
        return false;
    }
    return true;
}
<<<<<<< HEAD
function isValidPrimitiveAttributeValue(val) {
    switch (typeof val) {
=======
function isValidPrimitiveAttributeValueType(valType) {
    switch (valType) {
>>>>>>> 5e3222a0 (Initial commit for Agriconnect Kenya project)
        case 'number':
        case 'boolean':
        case 'string':
            return true;
    }
    return false;
}
//# sourceMappingURL=attributes.js.map